const express = require('express');
const app = express();
const http = require('http').createServer(app);
const io = require('socket.io')(http);

app.use(express.static('public'));

// Kart Destesi Oluşturma Fonksiyonu
function desteOlustur() {
    const renkler = ['S', 'H', 'C', 'D']; // Spades, Hearts, Clubs, Diamonds
    const degerler = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
    let deste = [];
    for (let r of renkler) {
        for (let d of degerler) {
            deste.push({ renk: r, deger: d });
        }
    }
    // Karıştırma (Shuffle) Algoritması
    return deste.sort(() => Math.random() - 0.5);
}

io.on('connection', (socket) => {
    console.log('Oyuncu masaya oturdu.');

    socket.on('secim', (oyun) => {
        const yeniDeste = desteOlustur();
        // Şimdilik sadece bağlanan oyuncuya 13 kart gönderiyoruz (Test için)
        const el = yeniDeste.slice(0, 13);
        
        io.emit('oyunBasladi', { oyun: oyun, kartlar: el });
    });

    socket.on('kartAt', (kart) => {
        io.emit('kartAtildi', { id: socket.id, kart: kart });
    });
});

const PORT = process.env.PORT || 3000;
http.listen(PORT, () => console.log('Sistem aktif!'));
